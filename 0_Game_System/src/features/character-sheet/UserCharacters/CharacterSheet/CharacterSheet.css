/*
    Created on : 04/11/2023
    Author     : Steven
*/

:root{
    /* ===== STEP 2: CONSOLIDATED DESIGN TOKENS ===== */
    
    /* Theme Colors - Primary Palette */
    --bg-form-neutral: #C1C3C7;
    --bg-form-orden: #0E79B2;
    --bg-form-caos: #E4572E;
    --bg-color-1: #E5E7EB;
    --bg-color-2: #191716;
    --bg-color-3: #F2AF29;
    --bg-color-4: #E63462;
    --bg-color-5: #9E2A2B;
    --bg-color-6: #DD8E2A;
    --bg-color-7: #31E981;
    --bg-color-8: #388697;
    --bg-color-9: #7F5A83;
    
    /* Semantic Color Mappings */
    --primary: var(--bg-color-3);
    --primary-rgb: 242, 175, 41;
    --danger: var(--bg-color-4);
    --danger-rgb: 230, 52, 98;
    --success: var(--bg-color-7);
    --success-rgb: 49, 233, 129;
    --required-color: var(--bg-color-4);
    --bg-color-btn-dice: var(--bg-color-3);
    --bg-title: var(--bg-color-3);
    --bg-loader: var(--bg-color-3);

    /* Typography System */
    --font-size-xs: 0.75rem;    /* 12px */
    --font-size-sm: 0.875rem;   /* 14px */
    --font-size-base: 1rem;     /* 16px */
    --font-size-lg: 1.125rem;   /* 18px */
    --font-size-xl: 1.25rem;    /* 20px */
    --font-size-2xl: 1.5rem;    /* 24px */
    --font-size-3xl: 1.875rem;  /* 30px */
    
    --line-height-tight: 1.25;
    --line-height-normal: 1.5;
    --line-height-relaxed: 1.75;
    
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;
    --font-weight-black: 900;
    
    /* Spacing System */
    --spacing-xs: 0.25rem;    /* 4px */
    --spacing-sm: 0.5rem;     /* 8px */
    --spacing-md: 0.75rem;    /* 12px */
    --spacing-lg: 1rem;       /* 16px */
    --spacing-xl: 1.25rem;    /* 20px */
    --spacing-2xl: 1.5rem;    /* 24px */
    --spacing-3xl: 2rem;      /* 32px */
    --spacing-4xl: 2.5rem;    /* 40px */
    
    /* Grid System */
    --grid-gap-tight: 0.5rem;
    --grid-gap-normal: 0.75rem;
    --grid-gap-relaxed: 1rem;
    --grid-gap-loose: 1.25rem;
    
    /* Form Element Sizing */
    --form-height-sm: 2.5rem;
    --form-height-md: 3rem;
    --form-height-lg: 3.5rem;
    
    /* Border Radius System (consolidated - removed duplicates) */
    --border-radius-sm: 0.375rem;
    --border-radius-md: 0.5rem;
    --border-radius-lg: 0.75rem;
    --border-radius-xl: 1rem;
    --border-card: 0.5rem; /* Legacy support */
    
    /* Border Colors */
    --border-light: #e5e7eb;
    --border-medium: #d1d5db;
    --border-dark: #9ca3af;
    
    /* Text Colors (consolidated - removed duplicates) */
    --text-primary: #1f2937;
    --text-secondary: #374151;
    --text-muted: #6b7280;
    
    /* Background Colors */
    --bg-grey-lighter: #f9fafb;
    --bg-main: #f8fafc;
    
    /* Shadow System */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    
    /* Focus Ring System */
    --focus-ring: 0 0 0 3px rgba(242, 175, 41, 0.1);
    --focus-ring-orden: 0 0 0 3px rgba(14, 121, 178, 0.1);
    --focus-ring-caos: 0 0 0 3px rgba(228, 87, 46, 0.1);
    
    /* Transition System (consolidated) */
    --transition-fast: all 0.15s ease;
    --transition-normal: all 0.2s ease;
    --transition-standard: 0.2s; /* Alias for compatibility */
    --transition-slow: all 0.3s ease;
    
    /* Legacy Support */
    --un-border-opacity: 1;
}


/* =====================================================
   GRID SYSTEM UTILITIES AND HELPERS
   ===================================================== */

/* Dynamic grid templates for complex layouts */
.grid-dynamic-1 { grid-template-columns: 1fr; }
.grid-dynamic-2 { grid-template-columns: repeat(2, 1fr); }
.grid-dynamic-3 { grid-template-columns: repeat(3, 1fr); }
.grid-dynamic-4 { grid-template-columns: repeat(4, 1fr); }
.grid-dynamic-6 { grid-template-columns: repeat(6, 1fr); }
.grid-dynamic-8 { grid-template-columns: repeat(8, 1fr); }
.grid-dynamic-12 { grid-template-columns: repeat(12, 1fr); }

/* Responsive grid modifiers */
@media (min-width: 768px) {
  .md\:grid-dynamic-2 { grid-template-columns: repeat(2, 1fr); }
  .md\:grid-dynamic-3 { grid-template-columns: repeat(3, 1fr); }
  .md\:grid-dynamic-4 { grid-template-columns: repeat(4, 1fr); }
  .md\:grid-dynamic-6 { grid-template-columns: repeat(6, 1fr); }
  .md\:grid-dynamic-8 { grid-template-columns: repeat(8, 1fr); }
}

@media (min-width: 1024px) {
  .lg\:grid-dynamic-3 { grid-template-columns: repeat(3, 1fr); }
  .lg\:grid-dynamic-4 { grid-template-columns: repeat(4, 1fr); }
  .lg\:grid-dynamic-6 { grid-template-columns: repeat(6, 1fr); }
  .lg\:grid-dynamic-8 { grid-template-columns: repeat(8, 1fr); }
  .lg\:grid-dynamic-12 { grid-template-columns: repeat(12, 1fr); }
}

/* Grid flow utilities */
.grid-flow-row { grid-auto-flow: row; }
.grid-flow-col { grid-auto-flow: column; }
.grid-flow-dense { grid-auto-flow: row dense; }

/* Advanced positioning utilities */
.justify-self-auto { justify-self: auto; }
.justify-self-start { justify-self: start; }
.justify-self-end { justify-self: end; }
.justify-self-center { justify-self: center; }
.justify-self-stretch { justify-self: stretch; }

.align-self-auto { align-self: auto; }
.align-self-start { align-self: start; }
.align-self-end { align-self: end; }
.align-self-center { align-self: center; }
.align-self-stretch { align-self: stretch; }

body{
    scrollbar-color: var(--bg-color-3) var(--bg-color-1) ;
    scrollbar-width: thin;
}

/* Focus state utilities */
.focus-ring {
    &:focus {
        border-color: var(--bg-color-3);
        box-shadow: var(--current-focus-ring);
        outline: none;
    }
}

.focus-ring-orden {
    &:focus {
        border-color: var(--bg-form-orden);
        box-shadow: var(--focus-ring-orden);
        outline: none;
    }
}

.focus-ring-caos {
    &:focus {
        border-color: var(--bg-form-caos);
        box-shadow: var(--focus-ring-caos);
        outline: none;
    }
}

/* =====================================================
   STEP 3: ENHANCED GRID SYSTEM - FORM SHEET LAYOUT
   ===================================================== */

.form-sheet {
    display: grid;
    min-height: 100vh;
    width: 100%;
    max-width: 100vw;
    margin: 0 auto;
    position: relative;
    overflow-x: hidden;
    /* Remove visible grid lines */
    grid-gap: var(--spacing-lg);
    gap: var(--spacing-lg);
    
    /* Explicitly remove any column dividers */
    background-image: none !important;
    -webkit-column-rule: none !important;
    -moz-column-rule: none !important;
    column-rule: none !important;
    
    /* ===== MOBILE-FIRST GRID LAYOUT ===== */
    /* Mobile (≤767px): Single column stack */
    grid-template-columns: 1fr;
    grid-template-rows: repeat(6, auto);
    grid-template-areas:
        "title"
        "info"
        "stats"
        "armament"
        "skills"
        "inventory";
    padding: var(--spacing-md);
    
    /* ===== RESPONSIVE BREAKPOINTS ===== */
    /* Tablet (768px - 1023px): Two column layout */
    @media (min-width: 768px) {
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: auto auto auto auto;
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        padding: var(--spacing-lg);
        gap: var(--spacing-xl);
        max-width: 1200px;
    }
      /* Desktop (1024px - 1599px): Optimized three column layout */
    @media (min-width: 1024px) {
        grid-template-columns: repeat(12, 1fr);
        grid-template-rows: auto auto auto auto auto;
        grid-template-areas:
            "title title title title title title title title title title title title"
            "info info info info info info info info info info info info"
            "stats stats stats stats armament armament armament armament . . . ."
            "stats stats stats stats skills skills skills skills . . . ."
            ". . . . inventory inventory inventory inventory inventory inventory inventory inventory";
        max-width: 1400px;
    }
      /* Large Desktop (≥1600px): Full wide layout */
    @media (min-width: 1600px) {
        grid-template-columns: repeat(16, 1fr);
        grid-template-rows: auto auto auto auto auto;
        grid-template-areas:
            "title title title title title title title title title title title title title title title title"
            "info info info info info info info info info info info info info info info info"
            "stats stats stats stats armament armament armament armament . . . . . . . ."
            "stats stats stats stats skills skills skills skills . . . . . . . ."
            ". . . . inventory inventory inventory inventory inventory inventory inventory inventory inventory inventory inventory inventory";
        max-width: 1800px;
    }
    
    /* ===== BACKGROUND AND THEMING ===== */
    background: linear-gradient(135deg, var(--bg-main) 0%, color-mix(in srgb, var(--bg-main) 95%, white) 100%);
    
    /* Pattern overlay for visual texture */
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-size: var(--spacing-3xl) var(--spacing-3xl);
        opacity: 0.03;
        pointer-events: none;
        z-index: 0;
    }
    
    /* Ensure content appears above pattern */
    > * {
        position: relative;
        z-index: 1;
    }
    
    /* Enhanced alignment-specific styling */
    &.orden {
        background: linear-gradient(135deg, var(--bg-form-orden) 0%, color-mix(in srgb, var(--bg-form-orden) 95%, white) 100%);
        --bg-color-btn-dice: var(--bg-form-orden);
        --required-color: var(--bg-form-orden);
        --bg-title: var(--bg-form-orden);
        --bg-loader: var(--bg-form-orden);
        --current-focus-ring: var(--focus-ring-orden);
        
        /* Order-specific pattern */
        &::before {
            background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%), 
                            linear-gradient(-45deg, rgba(255,255,255,0.1) 25%, transparent 25%), 
                            linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.1) 75%), 
                            linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.1) 75%);
        }
    }
    
    &.caos {
        background: linear-gradient(135deg, var(--bg-form-caos) 0%, color-mix(in srgb, var(--bg-form-caos) 95%, white) 100%);
        --bg-color-btn-dice: var(--bg-form-caos);
        --required-color: var(--bg-form-caos);
        --bg-title: var(--bg-form-caos);
        --bg-loader: var(--bg-form-caos);
        --current-focus-ring: var(--focus-ring-caos);
        /* Chaos-specific pattern */
        &::before {
            background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.2) 1px, transparent 0);
        }
    }
    
    /* ===== GRID AREA ASSIGNMENTS FOR FIELDSETS ===== */
    
    /* Form Title Section */
    .fieldset-form.form-title {
        grid-area: title;
    }
    
    /* Info Player Section */
    .fieldset-form.info-player {
        grid-area: info;
    }
    
    /* Stats Player Section */
    .fieldset-form.stats-player {
        grid-area: stats;
    }
    
    /* Initial Armament Section */
    .fieldset-form.initial-armament {
        grid-area: armament;
    }
    
    /* Skills Player Section */
    .fieldset-form.skills-player {
        grid-area: skills;
    }
    
    /* Inventory Player Section */
    .fieldset-form.inventory-player {
        grid-area: inventory;
    }
}

/* =====================================================
   ENHANCED FIELDSET ORGANIZATION WITH GRID AREAS
   ===================================================== */

/* Enhanced fieldset base layout */
.fieldset-form {
    display: grid;
    gap: var(--grid-gap-relaxed);
    padding: var(--spacing-2xl);
    margin: 0;
    border: 2px solid color-mix(in srgb, var(--bg-color-3) 20%, transparent);
    border-radius: var(--border-radius-lg);
    background: rgba(255, 255, 255, 0.98);
    
    /* Remove any potential vertical lines */
    -webkit-column-rule: none !important;
    -moz-column-rule: none !important;
    column-rule: none !important;
    background-image: none !important;
    
    /* Prevent column dividers */
    & > * {
        position: relative;
        &::before, &::after {
            display: none !important;
        }
    }
    backdrop-filter: blur(8px);
    transition: all var(--transition-standard) ease;
    
    /* Responsive padding adjustments */
    @media (max-width: 767px) {
        padding: var(--spacing-lg);
    }
    
    @media (min-width: 1024px) {
        padding: var(--spacing-3xl);
    }
    
    /* Hover effect for interactive enhancement */
    &:hover {
        box-shadow: 
            0 12px 48px rgba(0, 0, 0, 0.12),
            0 4px 12px rgba(0, 0, 0, 0.06),
            inset 0 1px 0 rgba(255, 255, 255, 0.95);
        transform: translateY(-2px);
    }
    
    /* Legend styling with enhanced typography */
    legend {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--text-primary);
        padding: var(--spacing-sm) var(--spacing-xl);
        background: linear-gradient(135deg, var(--bg-color-3) 0%, color-mix(in srgb, var(--bg-color-3) 85%, white) 100%);
        border: 2px solid color-mix(in srgb, var(--bg-color-3) 30%, transparent);
        border-radius: var(--border-radius-md);
        margin-bottom: var(--spacing-lg);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        letter-spacing: 0.5px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        
        /* Icon alignment */
        svg {
            vertical-align: middle;
            margin-right: var(--spacing-sm);
        }
    }
}

/* =====================================================
   SPECIFIC FIELDSET CONFIGURATIONS
   ===================================================== */

/* 1. Form Title Section */
.fieldset-form.form-title {
    grid-area: title;
    grid-template-columns: 1fr;
    min-height: auto;
    text-align: center;
    
    h1 {
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-black);
        margin: 0;
        color: var(--text-primary);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
}

/* 2. Info Player Section */
.fieldset-form.info-player {
    grid-area: info;
    grid-template-columns: 1fr 1fr; /* Cambiado a 1fr 1fr para tener columnas de igual ancho */
    grid-template-rows: repeat(10, auto);
    
    /* Removed visual separation between left and right columns */
    &::after {
        display: none;
    }
    
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: auto;
        
        &::after {
            display: none;
        }
    }
}

/* 3. Stats Player Section */
.fieldset-form.stats-player {
    grid-area: stats;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: auto repeat(6, 1fr);
    
    .stats-player-header {
        grid-column: 1 / -1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-md);
        background: color-mix(in srgb, var(--bg-color-2) 15%, transparent);
        border-radius: var(--border-radius-md);
        margin-bottom: var(--spacing-lg);
    }
}

/* 4. Initial Armament Section */
.fieldset-form.initial-armament {
    grid-area: armament;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(6, auto);
}

/* 5. Skills Player Section */
.fieldset-form.skills-player {
    grid-area: skills;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(8, auto);
}

/* 6. Inventory Player Section */
.fieldset-form.inventory-player {
    grid-area: inventory;
    grid-template-columns: 1fr !important; /* Force single column for the fieldset */
    grid-template-rows: auto 1fr auto;
    
    /* Ensure the inventory takes up the full width */
    & > div {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* Ensure inventory wrapper takes full width */
.inventory-wrapper {
    width: 100% !important;
    max-width: 100% !important;
    
    & .inventory-container {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* Override any other conflicting inventory grid layouts */
.fieldset-form.inventory-player {
    /* Responsive inventory layout */
    grid-template-columns: 1fr !important;
    
    @media (min-width: 768px) {
        grid-template-columns: 1fr !important;
    }
    
    @media (min-width: 1024px) {
        grid-template-columns: 1fr !important;
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: 1fr !important;
    }
}

/* =====================================================
   ENHANCED FIELDSET GRID CONFIGURATIONS
   ===================================================== */

/* 1. Form Title Section - Enhanced */
.fieldset-form.form-title {
    /* Improved layout */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: auto;
    
    /* Better responsive behavior */
    @media (max-width: 767px) {
        padding: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
        padding: var(--spacing-xl);
    }
    
    @media (min-width: 1024px) {
        padding: var(--spacing-2xl);
    }
}

/* 2. Info Player Section - Enhanced */
.fieldset-form.info-player {
    /* Mobile-first grid */
    grid-template-columns: 1fr;
    grid-template-rows: auto;
    gap: var(--spacing-md);
    
    /* Establecer variables CSS personalizadas para control centralizado */
    --info-field-min-width: 180px;
    --info-field-height: 3.5rem;
    
    @media (min-width: 768px) {
        /* Usar auto-fit para distribución automática y adaptable de columnas */
        grid-template-columns: repeat(auto-fit, minmax(var(--info-field-min-width), 1fr));
        grid-auto-rows: minmax(var(--info-field-height), auto);
        
        /* Ajustar el ancho mínimo para tablet */
        --info-field-min-width: 200px;
    }
    
    @media (min-width: 1024px) {
        /* Aumentar ligeramente el ancho mínimo para desktop */
        --info-field-min-width: 220px;
        --info-field-height: 3.75rem;
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1600px) {
        /* Pantallas extra grandes */
        --info-field-min-width: 240px;
        --info-field-height: 4rem;
    }
    
    /* Enhanced visual separation - ahora usa una variable CSS para posicionamiento */
    --separator-position: 50%;
    
    &::after {
        @media (min-width: 768px) {
            content: '';
            position: absolute;
            top: 3rem;
            left: var(--separator-position);
            bottom: 2rem;
            width: 1px;
            background: linear-gradient(180deg, 
                transparent 0%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 20%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 80%, 
                transparent 100%);
            z-index: 1;
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            display: none;
        }
    }
    
    /* Clases para ajustar el ancho de elementos específicos */
    .form-field-full {
        grid-column: 1 / -1;
    }
    
    .form-field-half {
        @media (min-width: 768px) {
            min-width: calc(var(--info-field-min-width) * 1.5);
        }
    }
}


/* 3. Stats Player Section - Enhanced */
.fieldset-form.stats-player {
    /* Base styles for all screen sizes */
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    
    @media (max-width: 767px) {
        /* Mobile: Simple stack */
        padding: var(--spacing-md);
    }
    
    @media (min-width: 768px) {
        /* Tablet and up: More padding and spacing */
        padding: var(--spacing-xl);
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1024px) {
        /* Desktop: Even more space */
        padding: var(--spacing-2xl);
        gap: var(--spacing-xl);
    }
    
    /* The header is now managed within the CharacterStats component */
    .stats-player-header {
        display: none; /* Remove legacy header */
    }
}

/* 4. Initial Armament Section - Enhanced */
.fieldset-form.initial-armament {
    /* Responsive grid layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    /* Better content organization */
    .weapon-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .skills-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }
}

/* 5. Skills Player Section - Enhanced */
.fieldset-form.skills-player {
    /* Responsive skill layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(8, auto);
    }
    
    @media (min-width: 768px) and (max-width: 1023px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, auto);
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, auto);
    }
}

/* 6. Inventory Player Section - Enhanced */
.fieldset-form.inventory-player {
    /* Responsive inventory layout */
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr auto;
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1024px) {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto 1fr auto;
    }
}
/* =====================================================
   GRID PERFORMANCE AND OPTIMIZATION ENHANCEMENTS
   ===================================================== */

/* Container queries for advanced responsive behavior */
/* Nota: Adaptado para complementar en lugar de conflictuar con media queries */
@container (min-width: 600px) and (max-width: 767px) {
    .fieldset-form.info-player {
        /* Solo aplicar en contenedores grandes pero viewport pequeño */
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}

@container (min-width: 800px) {
    .fieldset-form.stats-player {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* CSS Subgrid support for future enhancement */
@supports (grid-template-rows: subgrid) {
    .fieldset-form {
        display: grid;
        grid-template-rows: subgrid;
    }
}

/* Grid layout debugging utilities (development only) */
.debug-grid {
    position: relative;
    
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(to right, rgba(255, 0, 0, 0.1) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 
            calc(100% / var(--grid-columns, 12)) 
            calc(100% / var(--grid-rows, 12));
        pointer-events: none;
        z-index: 9999;
    }
    
    .fieldset-form {
        border: 1px dashed rgba(0, 255, 0, 0.5);
        position: relative;
        
        &::after {
            content: attr(class);
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 4px;
            font-size: 10px;
            z-index: 10000;
        }
    }
}

/* Layout shift prevention */
.form-sheet {
    /* Prevent cumulative layout shift */
    content-visibility: auto;
    contain-intrinsic-size: 100vh;
}

.fieldset-form {
    /* Minimize reflows during dynamic content loading */
    contain: layout style;
    
    /* Optimize for animations */
    &:has(.loading) {
        contain: layout style paint;
    }
}

/* =====================================================
   ACCESSIBILITY AND USER EXPERIENCE IMPROVEMENTS
   ===================================================== */

/* Focus management for grid navigation */
.form-sheet {
    /* Ensure logical focus order */
    &:focus-within {
        scroll-behavior: smooth;
    }
}

.fieldset-form {
    /* Screen reader navigation support */
    &[aria-expanded="false"] {
        max-height: 4rem;
        overflow: hidden;
        
        legend::after {
            content: " (minimized)";
            font-size: 0.8em;
            opacity: 0.7;
        }
    }
    
    /* Keyboard navigation enhancement */
    &:focus-within {
        z-index: 10;
        box-shadow: 
            var(--shadow-lg),
            0 0 0 3px rgba(var(--primary-rgb), 0.2);
    }
}

/* High contrast mode optimizations */
@media (prefers-contrast: high) {
    .form-sheet {
        gap: var(--spacing-xl);
    }
    
    .fieldset-form {
        border: 3px solid #000;
        background: #fff;
        
        &:focus-within {
            border-color: #0066cc;
        }
    }
    
    .grid-area-title { background: #000; color: #fff; }
    .grid-area-info { background: #f0f0f0; }
    .grid-area-stats { background: #e0e0e0; }
    .grid-area-armament { background: #d0d0d0; }
    .grid-area-skills { background: #c0c0c0; }
    .grid-area-inventory { background: #b0b0b0; }
}

/* Reduced motion optimizations */
@media (prefers-reduced-motion: reduce) {
    .form-sheet {
        scroll-behavior: auto;
        animation: none;
    }
    
    .fieldset-form {
        transition: none;
        transform: none !important;
    }
    
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Print optimizations for grid layout */
@media print {
    .form-sheet {
        display: block !important;
        grid-template-areas: none !important;
        gap: 0 !important;
        padding: 0 !important;
        background: white !important;
    }
    
    .fieldset-form {
        display: block !important;
        grid-template-columns: none !important;
        grid-area: auto !important;
        page-break-inside: avoid;
        margin-bottom: 1rem;
        border: 1px solid #000;
        background: white !important;
    }
    
    .panel-save,
    .debug-grid::before,
    .fieldset-form::after {
        display: none !important;
    }
}

.character-basic-info {
    /* Ensure no internal borders/dividers */
    border-right: none;
    position: relative;
    width: 100%;
}

/* Aplicar estos estilos automáticamente a los componentes info del personaje */
.character-basic-info .form-field,
.character-basic-info .info-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    border-right: none; /* Ensure no internal dividers */
    position: relative;
    width: 100%;
    justify-content: space-between;
}

/* Specific styles for labels in character-basic-info to make them more compact */
.character-basic-info .form-lbl,
.character-basic-info .form-lbl-y {
    min-width: 140px;
    max-width: 140px;
    flex: 0 0 140px;
    font-size: var(--font-size-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.character-basic-info .form-input,
.character-basic-info .form-input-y,
.character-basic-info .alignment-options {
    flex: 1 1 70%;
    min-width: 0; /* Evita que los inputs se desborden */
}

/* Mejorar el equilibrio entre etiquetas e inputs */
.horizontal-field {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    width: 100%;
    justify-content: space-between;
}

/* =====================================================
   ENHANCED GRID LAYOUT OPTIMIZATION
   ===================================================== */

/* Grid container performance optimization */
.form-sheet {
    /* Improve rendering performance */
    will-change: contents;
    contain: layout style;
    
    /* Enhanced content flow */
    overflow: visible;
    scroll-snap-type: y mandatory;
    
    /* Improved mobile-first approach */
    @media (max-width: 767px) {
        /* Ensure proper stacking on mobile */
        grid-template-rows: auto auto auto auto auto auto;
        scroll-padding-top: var(--spacing-lg);
        
        /* Mobile scroll snap points */
        .fieldset-form {
            scroll-snap-align: start;
            scroll-margin-top: var(--spacing-lg);
        }
    }
    /* Enhanced tablet optimization */
    @media (min-width: 768px) and (max-width: 1023px) {
        /* More balanced tablet grid */
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Better content distribution */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament {
            min-height: 350px;
        }
        
        .fieldset-form.skills-player,
        .fieldset-form.inventory-player {
            min-height: 400px;
        }
    }
    /* Enhanced desktop layout */
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Optimized fieldset heights for desktop */
        .fieldset-form.stats-player {
            min-height: 400px;
        }
        
        .fieldset-form.initial-armament {
            min-height: 400px;
        }
        
        .fieldset-form.skills-player {
            min-height: 450px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 500px;
        }
    }
    
    /* Ultra-wide optimizations */
    @media (min-width: 1600px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Maximum content optimization */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament,
        .fieldset-form.skills-player {
            min-height: 500px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 600px;
        }
    }
}

/* =====================================================
   ENHANCED FIELDSET GRID CONFIGURATIONS
   ===================================================== */

/* 1. Form Title Section - Enhanced */
.fieldset-form.form-title {
    /* Improved layout */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: auto;
    
    /* Better responsive behavior */
    @media (max-width: 767px) {
        padding: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
        padding: var(--spacing-xl);
    }
    
    @media (min-width: 1024px) {
        padding: var(--spacing-2xl);
    }
}

/* 2. Info Player Section - Enhanced */
.fieldset-form.info-player {
    /* Mobile-first grid */
    grid-template-columns: 1fr;
    grid-template-rows: auto;
    gap: var(--spacing-md);
    
    /* Establecer variables CSS personalizadas para control centralizado */
    --info-field-min-width: 180px;
    --info-field-height: 3.5rem;
    
    @media (min-width: 768px) {
        /* Usar auto-fit para distribución automática y adaptable de columnas */
        grid-template-columns: repeat(auto-fit, minmax(var(--info-field-min-width), 1fr));
        grid-auto-rows: minmax(var(--info-field-height), auto);
        
        /* Ajustar el ancho mínimo para tablet */
        --info-field-min-width: 200px;
    }
    
    @media (min-width: 1024px) {
        /* Aumentar ligeramente el ancho mínimo para desktop */
        --info-field-min-width: 220px;
        --info-field-height: 3.75rem;
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1600px) {
        /* Pantallas extra grandes */
        --info-field-min-width: 240px;
        --info-field-height: 4rem;
    }
    
    /* Enhanced visual separation - ahora usa una variable CSS para posicionamiento */
    --separator-position: 50%;
    
    &::after {
        @media (min-width: 768px) {
            content: '';
            position: absolute;
            top: 3rem;
            left: var(--separator-position);
            bottom: 2rem;
            width: 1px;
            background: linear-gradient(180deg, 
                transparent 0%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 20%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 80%, 
                transparent 100%);
            z-index: 1;
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            display: none;
        }
    }
    
    /* Clases para ajustar el ancho de elementos específicos */
    .form-field-full {
        grid-column: 1 / -1;
    }
    
    .form-field-half {
        @media (min-width: 768px) {
            min-width: calc(var(--info-field-min-width) * 1.5);
        }
    }
}


/* 3. Stats Player Section - Enhanced */
.fieldset-form.stats-player {
    /* Base styles for all screen sizes */
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    
    @media (max-width: 767px) {
        /* Mobile: Simple stack */
        padding: var(--spacing-md);
    }
    
    @media (min-width: 768px) {
        /* Tablet and up: More padding and spacing */
        padding: var(--spacing-xl);
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1024px) {
        /* Desktop: Even more space */
        padding: var(--spacing-2xl);
        gap: var(--spacing-xl);
    }
    
    /* The header is now managed within the CharacterStats component */
    .stats-player-header {
        display: none; /* Remove legacy header */
    }
}

/* 4. Initial Armament Section - Enhanced */
.fieldset-form.initial-armament {
    /* Responsive grid layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    /* Better content organization */
    .weapon-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .skills-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }
}

/* 5. Skills Player Section - Enhanced */
.fieldset-form.skills-player {
    /* Responsive skill layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(8, auto);
    }
    
    @media (min-width: 768px) and (max-width: 1023px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, auto);
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, auto);
    }
}

/* 6. Inventory Player Section - Enhanced */
.fieldset-form.inventory-player {
    /* Responsive inventory layout */
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr auto;
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1024px) {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto 1fr auto;
    }
}


/* =====================================================
   GRID PERFORMANCE AND OPTIMIZATION ENHANCEMENTS
   ===================================================== */

/* Container queries for advanced responsive behavior */
/* Nota: Adaptado para complementar en lugar de conflictuar con media queries */
@container (min-width: 600px) and (max-width: 767px) {
    .fieldset-form.info-player {
        /* Solo aplicar en contenedores grandes pero viewport pequeño */
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}

@container (min-width: 800px) {
    .fieldset-form.stats-player {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* CSS Subgrid support for future enhancement */
@supports (grid-template-rows: subgrid) {
    .fieldset-form {
        display: grid;
        grid-template-rows: subgrid;
    }
}

/* Grid layout debugging utilities (development only) */
.debug-grid {
    position: relative;
    
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(to right, rgba(255, 0, 0, 0.1) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 
            calc(100% / var(--grid-columns, 12)) 
            calc(100% / var(--grid-rows, 12));
        pointer-events: none;
        z-index: 9999;
    }
    
    .fieldset-form {
        border: 1px dashed rgba(0, 255, 0, 0.5);
        position: relative;
        
        &::after {
            content: attr(class);
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 4px;
            font-size: 10px;
            z-index: 10000;
        }
    }
}

/* Layout shift prevention */
.form-sheet {
    /* Prevent cumulative layout shift */
    content-visibility: auto;
    contain-intrinsic-size: 100vh;
}

.fieldset-form {
    /* Minimize reflows during dynamic content loading */
    contain: layout style;
    
    /* Optimize for animations */
    &:has(.loading) {
        contain: layout style paint;
    }
}

/* =====================================================
   ACCESSIBILITY AND USER EXPERIENCE IMPROVEMENTS
   ===================================================== */

/* Focus management for grid navigation */
.form-sheet {
    /* Ensure logical focus order */
    &:focus-within {
        scroll-behavior: smooth;
    }
}

.fieldset-form {
    /* Screen reader navigation support */
    &[aria-expanded="false"] {
        max-height: 4rem;
        overflow: hidden;
        
        legend::after {
            content: " (minimized)";
            font-size: 0.8em;
            opacity: 0.7;
        }
    }
    
    /* Keyboard navigation enhancement */
    &:focus-within {
        z-index: 10;
        box-shadow: 
            var(--shadow-lg),
            0 0 0 3px rgba(var(--primary-rgb), 0.2);
    }
}

/* High contrast mode optimizations */
@media (prefers-contrast: high) {
    .form-sheet {
        gap: var(--spacing-xl);
    }
    
    .fieldset-form {
        border: 3px solid #000;
        background: #fff;
        
        &:focus-within {
            border-color: #0066cc;
        }
    }
    
    .grid-area-title { background: #000; color: #fff; }
    .grid-area-info { background: #f0f0f0; }
    .grid-area-stats { background: #e0e0e0; }
    .grid-area-armament { background: #d0d0d0; }
    .grid-area-skills { background: #c0c0c0; }
    .grid-area-inventory { background: #b0b0b0; }
}

/* Reduced motion optimizations */
@media (prefers-reduced-motion: reduce) {
    .form-sheet {
        scroll-behavior: auto;
        animation: none;
    }
    
    .fieldset-form {
        transition: none;
        transform: none !important;
    }
    
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Print optimizations for grid layout */
@media print {
    .form-sheet {
        display: block !important;
        grid-template-areas: none !important;
        gap: 0 !important;
        padding: 0 !important;
        background: white !important;
    }
    
    .fieldset-form {
        display: block !important;
        grid-template-columns: none !important;
        grid-area: auto !important;
        page-break-inside: avoid;
        margin-bottom: 1rem;
        border: 1px solid #000;
        background: white !important;
    }
    
    .panel-save,
    .debug-grid::before,
    .fieldset-form::after {
        display: none !important;
    }
}

.character-basic-info {
    /* Ensure no internal borders/dividers */
    border-right: none;
    position: relative;
    width: 100%;
}

/* Aplicar estos estilos automáticamente a los componentes info del personaje */
.character-basic-info .form-field,
.character-basic-info .info-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    border-right: none; /* Ensure no internal dividers */
    position: relative;
    width: 100%;
    justify-content: space-between;
}

/* Specific styles for labels in character-basic-info to make them more compact */
.character-basic-info .form-lbl,
.character-basic-info .form-lbl-y {
    min-width: 140px;
    max-width: 140px;
    flex: 0 0 140px;
    font-size: var(--font-size-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.character-basic-info .form-input,
.character-basic-info .form-input-y,
.character-basic-info .alignment-options {
    flex: 1 1 70%;
    min-width: 0; /* Evita que los inputs se desborden */
}

/* Mejorar el equilibrio entre etiquetas e inputs */
.horizontal-field {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    width: 100%;
    justify-content: space-between;
}

/* =====================================================
   ENHANCED GRID LAYOUT OPTIMIZATION
   ===================================================== */

/* Grid container performance optimization */
.form-sheet {
    /* Improve rendering performance */
    will-change: contents;
    contain: layout style;
    
    /* Enhanced content flow */
    overflow: visible;
    scroll-snap-type: y mandatory;
    
    /* Improved mobile-first approach */
    @media (max-width: 767px) {
        /* Ensure proper stacking on mobile */
        grid-template-rows: auto auto auto auto auto auto;
        scroll-padding-top: var(--spacing-lg);
        
        /* Mobile scroll snap points */
        .fieldset-form {
            scroll-snap-align: start;
            scroll-margin-top: var(--spacing-lg);
        }
    }
    /* Enhanced tablet optimization */
    @media (min-width: 768px) and (max-width: 1023px) {
        /* More balanced tablet grid */
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Better content distribution */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament {
            min-height: 350px;
        }
        
        .fieldset-form.skills-player,
        .fieldset-form.inventory-player {
            min-height: 400px;
        }
    }
    /* Enhanced desktop layout */
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Optimized fieldset heights for desktop */
        .fieldset-form.stats-player {
            min-height: 400px;
        }
        
        .fieldset-form.initial-armament {
            min-height: 400px;
        }
        
        .fieldset-form.skills-player {
            min-height: 450px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 500px;
        }
    }
    
    /* Ultra-wide optimizations */
    @media (min-width: 1600px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Maximum content optimization */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament,
        .fieldset-form.skills-player {
            min-height: 500px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 600px;
        }
    }
}

/* =====================================================
   ENHANCED FIELDSET GRID CONFIGURATIONS
   ===================================================== */

/* 1. Form Title Section - Enhanced */
.fieldset-form.form-title {
    /* Improved layout */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: auto;
    
    /* Better responsive behavior */
    @media (max-width: 767px) {
        padding: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
        padding: var(--spacing-xl);
    }
    
    @media (min-width: 1024px) {
        padding: var(--spacing-2xl);
    }
}

/* 2. Info Player Section - Enhanced */
.fieldset-form.info-player {
    /* Mobile-first grid */
    grid-template-columns: 1fr;
    grid-template-rows: auto;
    gap: var(--spacing-md);
    
    /* Establecer variables CSS personalizadas para control centralizado */
    --info-field-min-width: 180px;
    --info-field-height: 3.5rem;
    
    @media (min-width: 768px) {
        /* Usar auto-fit para distribución automática y adaptable de columnas */
        grid-template-columns: repeat(auto-fit, minmax(var(--info-field-min-width), 1fr));
        grid-auto-rows: minmax(var(--info-field-height), auto);
        
        /* Ajustar el ancho mínimo para tablet */
        --info-field-min-width: 200px;
    }
    
    @media (min-width: 1024px) {
        /* Aumentar ligeramente el ancho mínimo para desktop */
        --info-field-min-width: 220px;
        --info-field-height: 3.75rem;
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1600px) {
        /* Pantallas extra grandes */
        --info-field-min-width: 240px;
        --info-field-height: 4rem;
    }
    
    /* Enhanced visual separation - ahora usa una variable CSS para posicionamiento */
    --separator-position: 50%;
    
    &::after {
        @media (min-width: 768px) {
            content: '';
            position: absolute;
            top: 3rem;
            left: var(--separator-position);
            bottom: 2rem;
            width: 1px;
            background: linear-gradient(180deg, 
                transparent 0%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 20%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 80%, 
                transparent 100%);
            z-index: 1;
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            display: none;
        }
    }
    
    /* Clases para ajustar el ancho de elementos específicos */
    .form-field-full {
        grid-column: 1 / -1;
    }
    
    .form-field-half {
        @media (min-width: 768px) {
            min-width: calc(var(--info-field-min-width) * 1.5);
        }
    }
}


/* 3. Stats Player Section - Enhanced */
.fieldset-form.stats-player {
    /* Base styles for all screen sizes */
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    
    @media (max-width: 767px) {
        /* Mobile: Simple stack */
        padding: var(--spacing-md);
    }
    
    @media (min-width: 768px) {
        /* Tablet and up: More padding and spacing */
        padding: var(--spacing-xl);
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1024px) {
        /* Desktop: Even more space */
        padding: var(--spacing-2xl);
        gap: var(--spacing-xl);
    }
    
    /* The header is now managed within the CharacterStats component */
    .stats-player-header {
        display: none; /* Remove legacy header */
    }
}

/* 4. Initial Armament Section - Enhanced */
.fieldset-form.initial-armament {
    /* Responsive grid layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    /* Better content organization */
    .weapon-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .skills-section {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
    }
}

/* 5. Skills Player Section - Enhanced */
.fieldset-form.skills-player {
    /* Responsive skill layout */
    @media (max-width: 767px) {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(8, auto);
    }
    
    @media (min-width: 768px) and (max-width: 1023px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(6, auto);
    }
    
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, auto);
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, auto);
    }
}

/* 6. Inventory Player Section - Enhanced */
.fieldset-form.inventory-player {
    /* Responsive inventory layout */
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr auto;
    
    @media (min-width: 768px) {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1024px) {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: auto 1fr auto;
    }
    
    @media (min-width: 1600px) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto 1fr auto;
    }
}


/* =====================================================
   GRID PERFORMANCE AND OPTIMIZATION ENHANCEMENTS
   ===================================================== */

/* Container queries for advanced responsive behavior */
/* Nota: Adaptado para complementar en lugar de conflictuar con media queries */
@container (min-width: 600px) and (max-width: 767px) {
    .fieldset-form.info-player {
        /* Solo aplicar en contenedores grandes pero viewport pequeño */
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}

@container (min-width: 800px) {
    .fieldset-form.stats-player {
        grid-template-columns: repeat(3, 1fr);
    }
}

/* CSS Subgrid support for future enhancement */
@supports (grid-template-rows: subgrid) {
    .fieldset-form {
        display: grid;
        grid-template-rows: subgrid;
    }
}

/* Grid layout debugging utilities (development only) */
.debug-grid {
    position: relative;
    
    &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(to right, rgba(255, 0, 0, 0.1) 1px, transparent 1px),
            linear-gradient(to bottom, rgba(255, 0, 0, 0.1) 1px, transparent 1px);
        background-size: 
            calc(100% / var(--grid-columns, 12)) 
            calc(100% / var(--grid-rows, 12));
        pointer-events: none;
        z-index: 9999;
    }
    
    .fieldset-form {
        border: 1px dashed rgba(0, 255, 0, 0.5);
        position: relative;
        
        &::after {
            content: attr(class);
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 4px;
            font-size: 10px;
            z-index: 10000;
        }
    }
}

/* Layout shift prevention */
.form-sheet {
    /* Prevent cumulative layout shift */
    content-visibility: auto;
    contain-intrinsic-size: 100vh;
}

.fieldset-form {
    /* Minimize reflows during dynamic content loading */
    contain: layout style;
    
    /* Optimize for animations */
    &:has(.loading) {
        contain: layout style paint;
    }
}

/* =====================================================
   ACCESSIBILITY AND USER EXPERIENCE IMPROVEMENTS
   ===================================================== */

/* Focus management for grid navigation */
.form-sheet {
    /* Ensure logical focus order */
    &:focus-within {
        scroll-behavior: smooth;
    }
}

.fieldset-form {
    /* Screen reader navigation support */
    &[aria-expanded="false"] {
        max-height: 4rem;
        overflow: hidden;
        
        legend::after {
            content: " (minimized)";
            font-size: 0.8em;
            opacity: 0.7;
        }
    }
    
    /* Keyboard navigation enhancement */
    &:focus-within {
        z-index: 10;
        box-shadow: 
            var(--shadow-lg),
            0 0 0 3px rgba(var(--primary-rgb), 0.2);
    }
}

/* High contrast mode optimizations */
@media (prefers-contrast: high) {
    .form-sheet {
        gap: var(--spacing-xl);
    }
    
    .fieldset-form {
        border: 3px solid #000;
        background: #fff;
        
        &:focus-within {
            border-color: #0066cc;
        }
    }
    
    .grid-area-title { background: #000; color: #fff; }
    .grid-area-info { background: #f0f0f0; }
    .grid-area-stats { background: #e0e0e0; }
    .grid-area-armament { background: #d0d0d0; }
    .grid-area-skills { background: #c0c0c0; }
    .grid-area-inventory { background: #b0b0b0; }
}

/* Reduced motion optimizations */
@media (prefers-reduced-motion: reduce) {
    .form-sheet {
        scroll-behavior: auto;
        animation: none;
    }
    
    .fieldset-form {
        transition: none;
        transform: none !important;
    }
    
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Print optimizations for grid layout */
@media print {
    .form-sheet {
        display: block !important;
        grid-template-areas: none !important;
        gap: 0 !important;
        padding: 0 !important;
        background: white !important;
    }
    
    .fieldset-form {
        display: block !important;
        grid-template-columns: none !important;
        grid-area: auto !important;
        page-break-inside: avoid;
        margin-bottom: 1rem;
        border: 1px solid #000;
        background: white !important;
    }
    
    .panel-save,
    .debug-grid::before,
    .fieldset-form::after {
        display: none !important;
    }
}

.character-basic-info {
    /* Ensure no internal borders/dividers */
    border-right: none;
    position: relative;
    width: 100%;
}

/* Aplicar estos estilos automáticamente a los componentes info del personaje */
.character-basic-info .form-field,
.character-basic-info .info-group {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    border-right: none; /* Ensure no internal dividers */
    position: relative;
    width: 100%;
    justify-content: space-between;
}

/* Specific styles for labels in character-basic-info to make them more compact */
.character-basic-info .form-lbl,
.character-basic-info .form-lbl-y {
    min-width: 140px;
    max-width: 140px;
    flex: 0 0 140px;
    font-size: var(--font-size-sm);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.character-basic-info .form-input,
.character-basic-info .form-input-y,
.character-basic-info .alignment-options {
    flex: 1 1 70%;
    min-width: 0; /* Evita que los inputs se desborden */
}

/* Mejorar el equilibrio entre etiquetas e inputs */
.horizontal-field {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 1rem;
    width: 100%;
    justify-content: space-between;
}

/* =====================================================
   ENHANCED GRID LAYOUT OPTIMIZATION
   ===================================================== */

/* Grid container performance optimization */
.form-sheet {
    /* Improve rendering performance */
    will-change: contents;
    contain: layout style;
    
    /* Enhanced content flow */
    overflow: visible;
    scroll-snap-type: y mandatory;
    
    /* Improved mobile-first approach */
    @media (max-width: 767px) {
        /* Ensure proper stacking on mobile */
        grid-template-rows: auto auto auto auto auto auto;
        scroll-padding-top: var(--spacing-lg);
        
        /* Mobile scroll snap points */
        .fieldset-form {
            scroll-snap-align: start;
            scroll-margin-top: var(--spacing-lg);
        }
    }
    /* Enhanced tablet optimization */
    @media (min-width: 768px) and (max-width: 1023px) {
        /* More balanced tablet grid */
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Better content distribution */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament {
            min-height: 350px;
        }
        
        .fieldset-form.skills-player,
        .fieldset-form.inventory-player {
            min-height: 400px;
        }
    }
    /* Enhanced desktop layout */
    @media (min-width: 1024px) and (max-width: 1599px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Optimized fieldset heights for desktop */
        .fieldset-form.stats-player {
            min-height: 400px;
        }
        
        .fieldset-form.initial-armament {
            min-height: 400px;
        }
        
        .fieldset-form.skills-player {
            min-height: 450px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 500px;
        }
    }
    
    /* Ultra-wide optimizations */
    @media (min-width: 1600px) {
        grid-template-columns: repeat(8, minmax(0, 1fr));
        grid-template-areas:
            "title title title title title title title title"
            "info info info info info info info info"
            "stats stats stats stats armament armament armament armament"
            "skills skills skills skills inventory inventory inventory inventory";
        
        /* Maximum content optimization */
        .fieldset-form.stats-player,
        .fieldset-form.initial-armament,
        .fieldset-form.skills-player {
            min-height: 500px;
        }
        
        .fieldset-form.inventory-player {
            min-height: 600px;
        }
    }
}

/* =====================================================
   ENHANCED FIELDSET GRID CONFIGURATIONS
   ===================================================== */

/* 1. Form Title Section - Enhanced */
.fieldset-form.form-title {
    /* Improved layout */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: auto;
    
    /* Better responsive behavior */
    @media (max-width: 767px) {
        padding: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
        padding: var(--spacing-xl);
    }
    
    @media (min-width: 1024px) {
        padding: var(--spacing-2xl);
    }
}

/* 2. Info Player Section - Enhanced */
.fieldset-form.info-player {
    /* Mobile-first grid */
    grid-template-columns: 1fr;
    grid-template-rows: auto;
    gap: var(--spacing-md);
    
    /* Establecer variables CSS personalizadas para control centralizado */
    --info-field-min-width: 180px;
    --info-field-height: 3.5rem;
    
    @media (min-width: 768px) {
        /* Usar auto-fit para distribución automática y adaptable de columnas */
        grid-template-columns: repeat(auto-fit, minmax(var(--info-field-min-width), 1fr));
        grid-auto-rows: minmax(var(--info-field-height), auto);
        
        /* Ajustar el ancho mínimo para tablet */
        --info-field-min-width: 200px;
    }
    
    @media (min-width: 1024px) {
        /* Aumentar ligeramente el ancho mínimo para desktop */
        --info-field-min-width: 220px;
        --info-field-height: 3.75rem;
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1600px) {
        /* Pantallas extra grandes */
        --info-field-min-width: 240px;
        --info-field-height: 4rem;
    }
    
    /* Enhanced visual separation - ahora usa una variable CSS para posicionamiento */
    --separator-position: 50%;
    
    &::after {
        @media (min-width: 768px) {
            content: '';
            position: absolute;
            top: 3rem;
            left: var(--separator-position);
            bottom: 2rem;
            width: 1px;
            background: linear-gradient(180deg, 
                transparent 0%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 20%, 
                color-mix(in srgb, var(--border-light) 60%, transparent) 80%, 
                transparent 100%);
            z-index: 1;
            pointer-events: none;
        }
        
        @media (max-width: 767px) {
            display: none;
        }
    }
    
    /* Clases para ajustar el ancho de elementos específicos */
    .form-field-full {
        grid-column: 1 / -1;
    }
    
    .form-field-half {
        @media (min-width: 768px) {
            min-width: calc(var(--info-field-min-width) * 1.5);
        }
    }
}


/* 3. Stats Player Section - Enhanced */
.fieldset-form.stats-player {
    /* Base styles for all screen sizes */
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    
    @media (max-width: 767px) {
        /* Mobile: Simple stack */
        padding: var(--spacing-md);
    }
    
    @media (min-width: 768px) {
        /* Tablet and up: More padding and spacing */
        padding: var(--spacing-xl);
        gap: var(--spacing-lg);
    }
    
    @media (min-width: 1024px) {
        /* Desktop: Even more space */
        padding: var(--spacing-2xl);
        gap: var(--spacing-xl);
    }
    
    /* The header is now managed within the CharacterStats component */
  }

.alignment-options button {
  flex: 1;
  padding: 0.5rem 1rem;
  border-radius: var(--border-radius-md);
  font-weight: var(--font-weight-medium);
  transition: all 0.2s ease;
  border: 1px solid var(--border-medium);
  background-color: white;
  color: var(--text-primary);
  cursor: pointer;
  text-align: center;
  min-width: 80px;
  margin: 0 0.25rem;
  position: relative;
  outline: none;
}

.alignment-options button.orden {
  border-color: var(--bg-form-orden);
  color: var(--bg-form-orden);
}

.alignment-options button.orden:hover,
.alignment-options button.orden.selected {
  background-color: var(--bg-form-orden);
  color: white;
}

.alignment-options button.neutral {
  border-color: var(--bg-form-neutral);
  color: var(--bg-form-neutral);
}

.alignment-options button.neutral:hover,
.alignment-options button.neutral.selected {
  background-color: var(--bg-form-neutral);
  color: white;
}

.alignment-options button.caos {
  border-color: var(--bg-form-caos);
  color: var(--bg-form-caos);
}

.alignment-options button.caos:hover,
.alignment-options button.caos.selected {
  background-color: var(--bg-form-caos);
  color: white;
}

/* Estilos con mayor especificidad para los botones de alineación */
.character-basic-info .info-group .alignment-options button.orden,
.character-basic-info .info-group .alignment-options button.neutral,
.character-basic-info .info-group .alignment-options button.caos {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 38px;
  min-height: 38px;
  font-size: var(--font-size-sm);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.character-basic-info .info-group .alignment-options button.orden.selected,
.character-basic-info .info-group .alignment-options button.neutral.selected,
.character-basic-info .info-group .alignment-options button.caos.selected {
  font-weight: var(--font-weight-bold);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transform: translateY(-1px);
}

/* Estilos adicionales para el contenedor de alineación */
.info-group .alignment-options.field-input {
  display: flex;
  gap: 0.5rem;
  min-height: var(--form-height-sm);
  padding: 0.25rem;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--border-light);
}